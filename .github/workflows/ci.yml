name: ci

on: push

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      # 1. 检出代码 (使用最新的 v6 版本)
      - name: Checkout
        uses: actions/checkout@v6

      # 2. 安装 Bun 环境
      # 它会自动读取你 package.json 里的 "packageManager" 来决定安装哪个版本
      - name: Install Bun
        uses: oven-sh/setup-bun@v2

      # 3. 安装依赖
      # --frozen-lockfile 意思是：必须完全依照 bun.lock 安装，不允许修改 lock 文件
      # 如果 lock 文件和 package.json 不匹配，CI 会直接报错
      - name: Install dependencies
        run: bun install --frozen-lockfile

      # 4. 代码规范检查（即使这一步红了，也会继续往下跑）
      - name: Lint
        run: bun run lint
        continue-on-error: true

      # 5. 类型检查
      - name: Typecheck
        run: bun run typecheck
